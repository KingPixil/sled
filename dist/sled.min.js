/**
 * Sled v0.0.0
 * Copyright 2017 Kabir Shah
 * Released under the MIT License
 */
!function(t,e){"object"==typeof module&&module.exports?module.exports=e():t.Sled=e()}(this,function(){function t(t){this.el=document.querySelector(t),this.data=[e("p","")],this.nodeStart=0,this.nodeEnd=0,this.cursorStart=0,this.cursorEnd=0,this.el.setAttribute("contenteditable","true"),this.el.setAttribute("data-sled","");var n=this;this.el.addEventListener("keypress",function(t){n.editText(String.fromCharCode(t.keyCode))}),this.el.addEventListener("paste",function(t){n.editText(t.clipboardData.getData("Text"))}),this.el.addEventListener("keydown",function(t){}),document.addEventListener("selectionchange",function(t){n.handleCursor(t)}),this.build()}var e=function(t,e){return{type:t,content:e}},n=function(t,e){var n=document.createElement(t.type);return n.textContent=t.content,n.__sledIndex__=e,0===t.content.length&&n.appendChild(document.createElement("br")),n};return t.prototype.editText=function(t){var e=this.cursorStart,n=this.cursorEnd,o=this.nodeStart,i=this.nodeEnd,d=this.data,r=d[o],s=r.content;if(e===n)r.content=s.slice(0,e)+t+s.slice(e);else if(o===i)r.content=s.slice(0,e)+t+s.slice(n);else{var a=d[i].content;r.content=0===e?t:s.slice(0,e)+t,n!==a.length&&(r.content+=a.slice(n));for(var l=i;l<o;l++)d.splice(l,1)}this.updateIndex()},t.prototype.handleCursor=function(t){var e=document.getSelection(),n=e.focusNode;if(null!==n){var o=n.parentNode,i=e.anchorNode.parentNode;if(void 0!==o.__sledIndex__){var d=e.focusOffset,r=e.anchorOffset;if(r<d){var s=d;d=r,r=s}var a=o.__sledIndex__,l=i.__sledIndex__;if(l<a){var s=a;a=l,l=s}this.cursorStart=d,this.cursorEnd=r,this.nodeStart=a,this.nodeEnd=l}}},t.prototype.load=function(t){this.data=t,this.build()},t.prototype.updateIndex=function(){for(var t=this.data,e=this.el.firstChild,n=0;n<t.length;n++)e.__sledIndex__!==n&&(e.__sledIndex__=n)},t.prototype.build=function(){for(var t=this.el,e=this.data,o=t.firstChild,i=0;i<e.length;i++){var d=e[i];if(null===o)o=n(d,i),t.appendChild(o);else{if(o.nodeName.toLowerCase()!==d.type){var r=o;o=n(d,i),t.replaceChild(o,r)}i!==o.__sledIndex__&&(o.__sledIndex__=i),d.content!==o.textContent&&(o.textContent=d.content)}o=o.nextSibling}},t.version="0.0.0",t});